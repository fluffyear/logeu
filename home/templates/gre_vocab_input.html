<!DOCTYPE html>
{% load static %}
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Logeu: AS Vocab Greek Typed</title>
    <link rel="stylesheet" id="styleSheet" href="{% static 'home/appStyle.css' %}" />
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Catamaran&display=swap')
        #div_1 {}
        #div_2 { display: none }
    </style>
</head>
<body>
<div id="div_1">
    Translate <span id="starter" style="color:#02c3e0;">{{ ans_greek }}</span><br>
    <input id="userInput" type="text" placeholder="English" maxLength="64" style="width: 300px; font-size: 25pt; margin-top: 15px; margin-bottom: 15px;" >
    <button id="pogBtn" onclick="app()" style="padding: 0px 20px; height: 45px; font-size: 22pt;">Submit</button><br>
    <a href="/home">Home</a>
</div>
<div id="div_2">
    <p><span id="wrong" style="color:#f7510a">Incorrect!</span></p><span id="corrected" style="color:#f7510a;">{{ ans_greek }}:<br>{{ ans_word }}</span>
        <br><br><br><input type="button" value="nice" onclick="updateContext()">&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<a href="/home">Home</a>
</div>
    <script type="text/javascript">
        if (localStorage.getItem("theme") == "dark-mode") { document.getElementById("styleSheet").href = '{% static 'home/appStyleDark.css' %}' } else { document.getElementById("styleSheet").href = '{% static 'home/appStyle.css' %}' }
        var wordLst = "{{ans_word_list}}".split(',')
        var members = wordLst.map(e => { return e.toLowerCase().replace(/\([^()]*\)/g, '') })
        const input = document.getElementById("userInput")
        input.addEventListener("keyup", function(event) {
          if (event.keyCode === 13) {
            document.getElementById("pogBtn").click()
          }
        })
        function app() {
          document.getElementById("div_1").style.display = "none"
          document.getElementById("div_2").style.display = "block"
          var targeted = document.getElementById("wrong")
          var ansBool = 2
          var input = document.getElementById("userInput").value
          var ans = input.split(",").map(e => { return e.toLowerCase().trim().replace(/\([^()]*\)/g, '').trim() })
          var ansFiltered = ans.filter(element => members.includes(element))
          if (ans.length != ansFiltered.length) { if (ansFiltered.length > 0) { ansBool = 1 } else { ansBool = 0 } }
          console.log(members, ans, ansFiltered)
          if (ansBool == 2) {
            targeted.innerHTML = "Correct!"
            targeted.style.color = "#72d61a"
            document.getElementById("corrected").style.color = "#72d61a"
          } else if (ansBool == 1) {
            targeted.style.color = "#f7510a"
            correct = ansFiltered.toString().replace(",", ", ")
            incorrect = ans.filter(e => !ansFiltered.includes(e)).toString().replace(",", ", ")
            targeted.innerHTML = `<span style='color:#ffbb00;'>${input}</span> is incorrect`
            document.getElementById("corrected").style.color = "#f7510a"
          } else if (input.length != 0) {
            targeted.style.color = "#f7510a"
            targeted.innerHTML = `${input} is incorrect`
            document.getElementById("corrected").style.color = "#f7510a"
          }
        }
        function updateContext() {
          fetch("{% url 'updateGreVocabInput' %}", {
            method: "GET",
            headers: {"X-Requested-With": "XMLHttpRequest"}
          })
          .then(res => res.json())
          .then(data => {
            const jsonDct = {}
            data.context.forEach(([key, val]) => jsonDct[key] = val)
            members = jsonDct['ans_word_list'].split(',').map(e => { return e.toLowerCase().replace(/\([^()]*\)/g, '').trim() })
            document.getElementById("starter").innerHTML = jsonDct['ans_greek']
            document.getElementById("corrected").innerHTML = `${jsonDct['ans_greek']}:<br>${jsonDct['ans_word']}`
            document.getElementById("userInput").value = ""
            document.getElementById("div_1").style.display = "block"
            document.getElementById("div_2").style.display = "none"
          })
        }
    </script>
</body>
</html>